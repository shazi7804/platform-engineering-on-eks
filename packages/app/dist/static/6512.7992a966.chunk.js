"use strict";(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6512],{26512:(be,N,a)=>{a.r(N),a.d(N,{Router:()=>Ke});var e=a(85668),z=a(66272),g=a(33648),U=a(66440),j=a(83024),v=a(87696),f=a(64300),P=a(8024),D=a(91812),R=a(29292),T=a(38348),A=a(52316),X=a(1275),F=a(67256),Z=a(95664),q=a(88224),ee=a(19664),te=a(19163),L=a(17376),ae=a(48152),ne=a(99812),W=a(40476),k=a(53232),$=a(54828),Q=a(87132),H=a(6280),V=a(42704),Y=a(1700),J=a(43152),le=a(77600),G=a(87987),oe=a(59264),b=a(58368),re=a(19540),se=a(44168),ie=a(35848),ce=a(71252),we=a.n(ce),Ne=a(40459),me=a(26044),ze=a.n(me),Ee=a(55632),je=a.n(Ee),de=a(98880),Xe=a.n(de),ue=a(55224),ke=a.n(ue),$e=a(37836),_e=a(28364),Qe=a.n(_e);const pe=t=>{const{title:n,to:l}=t,{allowed:i}=(0,te.wQ)({permission:ee.ai}),r=(0,Z.c)(m=>m.breakpoints.down("xs"));return!l||!i?null:r?e.createElement(F.c,{component:z.cH,color:"primary",title:n,size:"small",to:l},e.createElement(q.c,null)):e.createElement(X.c,{component:z.cH,variant:"contained",color:"primary",to:l},n)},fe={title:"Templates",filter:()=>!0},ve=t=>[...t,{title:"Other Templates",filter:n=>![...t].some(({filter:l})=>l(n))}],Oe=t=>{var n,l,i;const r=(0,D.M7)(f.u),{TemplateCardComponent:m,groups:s=[],templateFilter:p,headerOptions:_}=t,c=(0,g.i6)(),u=(0,D.M7)(f.p),M=(0,D.M7)(f.q),E=(0,D.M7)(f.t),O=(0,D.M7)(f.v),C=(0,D.M7)(f.o),h=(0,D.IT)(),o=s.length?ve(s):[fe],d={onEditorClicked:((n=t==null?void 0:t.contextMenu)==null?void 0:n.editor)!==!1?()=>c(u()):void 0,onActionsClicked:((l=t==null?void 0:t.contextMenu)==null?void 0:l.actions)!==!1?()=>c(M()):void 0,onTasksClicked:((i=t==null?void 0:t.contextMenu)==null?void 0:i.tasks)!==!1?()=>c(E()):void 0},y=(0,e.useCallback)(K=>{var B,S;const{kind:Be,namespace:Se,name:Fe}=(0,L.WK)((0,L.Qj)(K));return(B=K.metadata.annotations)!=null&&B["backstage.io/techdocs-ref"]&&O?[{icon:(S=h.getSystemIcon("docs"))!=null?S:P.Q1,text:"View TechDocs",url:O({kind:Be,namespace:Se,name:Fe})}]:[]},[h,O]),x=(0,e.useCallback)(K=>{const{namespace:B,name:S}=(0,L.WK)((0,L.Qj)(K));c(C({namespace:B,templateName:S}))},[c,C]);return e.createElement(T.a0,null,e.createElement(P.K2,{themeId:"home"},e.createElement(P.ek,{pageTitleOverride:"Create a new component",title:"Create a new component",subtitle:"Create new software components using standard templates in your organization",..._},e.createElement(A.gV,{...d})),e.createElement(P.kP,null,e.createElement(P.YC,{title:"Available Templates"},e.createElement(pe,{title:"Register Existing Component",to:r&&r()}),e.createElement(P.iY,null,"Create new software components using standard templates. Different templates create different kinds of components (services, websites, documentation, ...).")),e.createElement(T.UJ,null,e.createElement(T.UJ.Filters,null,e.createElement(T.Ib,null),e.createElement(T.tR,{initialFilter:"template",hidden:!0}),e.createElement(T.Mb,{initialFilter:"all",availableFilters:["all","starred"]}),e.createElement(A.iO,null),e.createElement(T.ER,null)),e.createElement(T.UJ.Content,null,e.createElement(A.wT,{groups:o,templateFilter:p,TemplateCardComponent:m,onTemplateSelected:x,additionalLinksForEntity:y}))))))},ge=t=>{const n=(0,D.M7)(f.r),l=(0,D.M7)(f.w),{secrets:i}=(0,U.u)(),r=(0,R.u)(U.s),m=(0,g.i6)(),{templateName:s,namespace:p}=(0,D.oD)(f.o),_=(0,L.Qj)({kind:"Template",namespace:p,name:s}),c=async M=>{const{taskId:E}=await r.scaffold({templateRef:_,values:M,secrets:i});m(l({taskId:E}))},u=()=>e.createElement(g.YX,{to:n()});return e.createElement(D.cz,{attributes:{entityRef:_}},e.createElement(P.K2,{themeId:"website"},e.createElement(P.ek,{pageTitleOverride:"Create a new component",title:"Create a new component",subtitle:"Create new software components using standard templates in your organization",...t.headerOptions}),e.createElement(A.gH,{namespace:p,templateName:s,onCreate:c,components:t.components,onError:u,extensions:t.customFieldExtensions,formProps:t.formProps,layouts:t.layouts})))};var Pe=Object.defineProperty,Me=(t,n,l)=>n in t?Pe(t,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[n]=l,De=(t,n,l)=>(Me(t,typeof n!="symbol"?n+"":n,l),l);const Ce=(0,W.c)({containerWrapper:{position:"relative",width:"100%",height:"100%"},container:{position:"absolute",top:0,bottom:0,left:0,right:0,overflow:"auto"}});class Te extends e.Component{constructor(){super(...arguments),De(this,"state",{shouldRender:!0})}componentDidUpdate(n){n.invalidator!==this.props.invalidator&&this.setState({shouldRender:!0})}componentDidCatch(n){this.props.setErrorText(n.message),this.setState({shouldRender:!1})}render(){return this.state.shouldRender?this.props.children:null}}function w(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function I(t){const{content:n,contentIsSpec:l,onDryRun:i,setErrorText:r,fieldExtensions:m=[],layouts:s=[]}=t,p=Ce(),_=(0,R.b)(),[c,u]=(0,e.useState)(),M=(0,e.useMemo)(()=>Object.fromEntries(m.map(({name:E,component:O})=>[E,O])),[m]);return(0,re.c)(()=>{try{if(!n){u(void 0);return}const E=b.cp.parseAllDocuments(n).filter(o=>o).map(o=>o.toJSON())[0];if(!w(E)){u(void 0);return}let O=E;if(!l){if(!(String(E.kind).toLocaleLowerCase("en-US")==="template")){u(void 0);return}O=w(E.spec)?E.spec:{}}const{parameters:C}=O;if(!Array.isArray(C)){r("Template parameters must be an array"),u(void 0);return}const h=Object.fromEntries(m.map(({name:o,validation:d})=>[o,d]));r(),u(C.flatMap(o=>w(o)?[{title:String(o.title),schema:o,validate:(0,A.jV)(o,h,{apiHolder:_})}]:[]))}catch(E){r(E.message)}},250,[l,n,_]),c?e.createElement("div",{className:p.containerWrapper},e.createElement("div",{className:p.container},e.createElement(Te,{invalidator:c,setErrorText:r},e.createElement(A.mZ,{manifest:{steps:c,title:"Template Editor"},extensions:m,components:M,onCreate:async E=>{await(i==null?void 0:i(E))},layouts:s})))):null}function he(t){const{setErrorText:n,fieldExtensions:l=[],layouts:i}=t,r=(0,v.u)(),m=(0,v.a)(),{selectedFile:s}=m,p=async c=>{if(s)try{await r.execute({templateContent:s.content,values:c,files:m.files}),n()}catch(u){throw n(String(u.cause||u)),u}},_=s&&s.path.match(/\.ya?ml$/)?s.content:void 0;return e.createElement(I,{onDryRun:p,fieldExtensions:l,setErrorText:n,content:_,layouts:i})}I.DirectoryEditorDryRun=he;const Ae=(0,W.c)(t=>({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "controls controls"
      "fieldForm preview"
    `,gridTemplateRows:"auto 1fr",gridTemplateColumns:"1fr 1fr"},controls:{gridArea:"controls",display:"flex",flexFlow:"row nowrap",alignItems:"center",margin:t.spacing(1)},fieldForm:{gridArea:"fieldForm"},preview:{gridArea:"preview"}})),ye=({customFieldExtensions:t=[],onClose:n})=>{var l,i;const r=Ae(),m=t.filter(o=>!!o.schema),[s,p]=(0,e.useState)(m[0]),[_,c]=(0,e.useState)({}),[u,M]=(0,e.useState)(Date.now()),E=(0,e.useMemo)(()=>{var o,d;return b.cp.stringify({parameters:[{title:`${s.name} Example`,properties:{[s.name]:{type:(d=(o=s.schema)==null?void 0:o.returnValue)==null?void 0:d.type,"ui:field":s.name,"ui:options":_}}}]})},[_,s]),O=(0,e.useMemo)(()=>Object.fromEntries(t.map(({name:o,component:d})=>[o,d])),[t]),C=(0,e.useCallback)(o=>{p(o),c({})},[c,p]),h=(0,e.useCallback)(o=>{c(o),M(Date.now())},[c,M]);return e.createElement("main",{className:r.root},e.createElement("div",{className:r.controls},e.createElement(k.c,{variant:"outlined",size:"small",fullWidth:!0},e.createElement($.c,{id:"select-field-label"},"Choose Custom Field Extension"),e.createElement(Q.c,{value:s,label:"Choose Custom Field Extension",labelId:"select-field-label",onChange:o=>C(o.target.value)},m.map((o,d)=>e.createElement(H.c,{key:d,value:o},o.name)))),e.createElement(F.c,{size:"medium",onClick:n,"aria-label":"Close"},e.createElement(G.c,null))),e.createElement("div",{className:r.fieldForm},e.createElement(V.c,null,e.createElement(Y.c,{title:"Field Options"}),e.createElement(J.c,null,e.createElement(A.QF,{showErrorList:!1,fields:{...O},noHtml5Validate:!0,formData:_,formContext:{fieldFormState:_},onSubmit:o=>h(o.formData),validator:se.cp,schema:((l=s.schema)==null?void 0:l.uiOptions)||{},experimental_defaultFormStateBehavior:{allOf:"populateDefaults"}},e.createElement(X.c,{variant:"contained",color:"primary",type:"submit",disabled:!((i=s.schema)!=null&&i.uiOptions)},"Apply"))))),e.createElement("div",{className:r.preview},e.createElement(V.c,null,e.createElement(Y.c,{title:"Example Template Spec"}),e.createElement(J.c,null,e.createElement(oe.cp,{readOnly:!0,theme:"dark",height:"100%",extensions:[ae.i_.define(ne.o)],value:E}))),e.createElement(I,{key:u,content:E,contentIsSpec:!0,fieldExtensions:t,setErrorText:()=>null})))},Re=(0,W.c)({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "browser editor preview"
      "results results results"
    `,gridTemplateColumns:"1fr 3fr 2fr",gridTemplateRows:"1fr auto"},browser:{gridArea:"browser",overflow:"auto"},editor:{gridArea:"editor",overflow:"auto"},preview:{gridArea:"preview",overflow:"auto"},results:{gridArea:"results"}}),Le=t=>{const n=Re(),[l,i]=(0,e.useState)();return e.createElement(v.D,{directory:t.directory},e.createElement(v.b,null,e.createElement("main",{className:n.root},e.createElement("section",{className:n.browser},e.createElement(v.T,{onClose:t.onClose})),e.createElement("section",{className:n.editor},e.createElement(v.c.DirectoryEditor,{errorText:l})),e.createElement("section",{className:n.preview},e.createElement(I.DirectoryEditorDryRun,{setErrorText:i,fieldExtensions:t.fieldExtensions,layouts:t.layouts})),e.createElement("section",{className:n.results},e.createElement(v.d,null)))))},Ie=`# Edit the template parameters below to see how they will render in the scaffolder form UI
parameters:
  - title: Fill in some steps
    required:
      - name
    properties:
      name:
        title: Name
        type: string
        description: Unique name of the component
      owner:
        title: Owner
        type: string
        description: Owner of the component
        ui:field: OwnerPicker
        ui:options:
          catalogFilter:
            kind: Group
  - title: Choose a location
    required:
      - repoUrl
    properties:
      repoUrl:
        title: Repository Location
        type: string
        ui:field: RepoUrlPicker
        ui:options:
          allowedHosts:
            - github.com
steps:
  - id: fetch-base
    name: Fetch Base
    action: fetch:template
    input:
      url: ./template
      values:
        name: \${{parameters.name}}
`,Ue=(0,W.c)(t=>({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "controls controls"
      "textArea preview"
    `,gridTemplateRows:"auto 1fr",gridTemplateColumns:"1fr 1fr"},controls:{gridArea:"controls",display:"flex",flexFlow:"row nowrap",alignItems:"center",margin:t.spacing(1)},textArea:{gridArea:"textArea"},preview:{gridArea:"preview"}})),We=({defaultPreviewTemplate:t=Ie,customFieldExtensions:n=[],onClose:l,layouts:i=[]})=>{const r=Ue(),m=(0,R.u)(R.l),s=(0,R.u)(T.sf),[p,_]=(0,e.useState)(""),[c,u]=(0,e.useState)(),[M,E]=(0,e.useState)([]),[O,C]=(0,e.useState)(t),{loading:h}=(0,ie.default)(()=>s.getEntities({filter:{kind:"template"},fields:["kind","metadata.namespace","metadata.name","metadata.title","spec.parameters","spec.steps","spec.output"]}).then(({items:d})=>E(d.map(y=>{var x;return{label:(x=y.metadata.title)!=null?x:(0,T.g$)(y,{defaultKind:"template"}),value:y}}))).catch(d=>m.post({message:`Error loading exisiting templates: ${d.message}`,severity:"error"})),[s]),o=(0,e.useCallback)(d=>{_(d),C(b.cp.stringify(d.spec))},[C]);return e.createElement(e.Fragment,null,h&&e.createElement(le.c,null),e.createElement("main",{className:r.root},e.createElement("div",{className:r.controls},e.createElement(k.c,{variant:"outlined",size:"small",fullWidth:!0},e.createElement($.c,{id:"select-template-label"},"Load Existing Template"),e.createElement(Q.c,{value:p,label:"Load Existing Template",labelId:"select-template-label",onChange:d=>o(d.target.value)},M.map((d,y)=>e.createElement(H.c,{key:y,value:d.value},d.label)))),e.createElement(F.c,{size:"medium",onClick:l},e.createElement(G.c,null))),e.createElement("div",{className:r.textArea},e.createElement(v.c,{content:O,onUpdate:C,errorText:c})),e.createElement("div",{className:r.preview},e.createElement(I,{content:O,contentIsSpec:!0,fieldExtensions:n,setErrorText:u,layouts:i}))))};function xe(t){const[n,l]=(0,e.useState)();let i=null;return(n==null?void 0:n.type)==="local"?i=e.createElement(Le,{directory:n.directory,fieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0),layouts:t.layouts}):(n==null?void 0:n.type)==="form"?i=e.createElement(We,{defaultPreviewTemplate:t.defaultPreviewTemplate,customFieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0),layouts:t.layouts}):(n==null?void 0:n.type)==="field-explorer"?i=e.createElement(ye,{customFieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0)}):i=e.createElement(P.kP,null,e.createElement(v.e,{onSelect:r=>{r==="local"?v.W.requestDirectoryAccess().then(m=>l({type:"local",directory:m})).catch(()=>{}):r==="form"?l({type:"form"}):r==="field-explorer"&&l({type:"field-explorer"})}})),e.createElement(P.K2,{themeId:"home"},e.createElement(P.ek,{title:"Template Editor",subtitle:"Edit, preview, and try out templates and template forms"}),i)}const Ke=t=>{const{components:{TemplateCardComponent:n,TaskPageComponent:l=f.e,ReviewStepComponent:i,EXPERIMENTAL_TemplateOutputsComponent:r,EXPERIMENTAL_TemplateListPageComponent:m=Oe,EXPERIMENTAL_TemplateWizardPageComponent:s=ge}={}}=t,p=(0,g.ag)()||t.children,_=(0,j.m_)(p),c=[..._,...v.f.filter(({name:M})=>!_.some(E=>E.name===M))],u=(0,j.qA)(p);return e.createElement(g.c5,null,e.createElement(g.kX,{path:"/",element:e.createElement(m,{TemplateCardComponent:n,contextMenu:t.contextMenu,groups:t.groups,templateFilter:t.templateFilter,headerOptions:t.headerOptions})}),e.createElement(g.kX,{path:f.o.path,element:e.createElement(U.S,null,e.createElement(s,{headerOptions:t.headerOptions,customFieldExtensions:c,layouts:u,components:{ReviewStepComponent:i},formProps:t.formProps}))}),e.createElement(g.kX,{path:f.w.path,element:e.createElement(l,{TemplateOutputsComponent:r})}),e.createElement(g.kX,{path:f.p.path,element:e.createElement(U.S,null,e.createElement(xe,{customFieldExtensions:c,layouts:u}))}),e.createElement(g.kX,{path:f.q.path,element:e.createElement(v.A,null)}),e.createElement(g.kX,{path:f.t.path,element:e.createElement(v.L,null)}),e.createElement(g.kX,{path:"*",element:e.createElement(P.ao,{status:"404",statusMessage:"Page not found"})}))}}}]);})();

//# sourceMappingURL=6512.7992a966.chunk.js.map